<same code as before with new features>